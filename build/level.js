// Generated by CoffeeScript 1.10.0
(function() {
  this.Level = (function() {
    Level.prototype.OFFSET = 150;

    function Level(game) {
      this.game = game;
      this.index = 0;
      $.ajaxSetup({
        cache: false
      });
      $.getJSON('src/levels.json', (function(_this) {
        return function(json) {
          _this.landscape = new THREE.Mesh(Models.landscape.geometry, Models.landscape.materials);
          _this.landscape.rotation.x += 90 * DEGREES_TO_RADIANS;
          _this.landscape.scale.set(50, 50, 50);
          _this.landscape.castShadow = true;
          _this.landscape.receiveShadow = true;
          _this.landscape.position.z += 5;
          _this.landscape.position.x -= 300;
          _this.landscape.position.y += 200;
          _this.game.addToScene(_this.landscape);
          _this.levels = json['levels'];
          return _this.load(_this.index);
        };
      })(this));
    }

    Level.prototype.hasNextLevel = function() {
      return this.index < this.levels.length - 1;
    };

    Level.prototype.nextLevel = function() {
      this.index += 1;
      this.clear();
      return this.load(this.index);
    };

    Level.prototype.currentLength = function() {
      return this.length - this.OFFSET;
    };

    Level.prototype.load = function(num) {
      var i, len, level, obstacle, ref, results;
      this.obstacles = [];
      level = this.levels[num];
      this.length = level.length;
      this.floor = new Cube(this.game, 100, this.length + 100, 10, true);
      this.floor.setPosition(0, (this.length / 2) - this.OFFSET, 0);
      this.floor.setName('Floor');
      if (num === 0) {
        this.loadTutotial();
      }
      ref = level['obstacles'];
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        obstacle = ref[i];
        if (obstacle.type === 'Low') {
          results.push(this.obstacles.push(new Low(this.game, obstacle.y, obstacle.lane)));
        } else if (obstacle.type === 'High') {
          results.push(this.obstacles.push(new High(this.game, obstacle.y, obstacle.lane)));
        } else if (obstacle.type === 'Full') {
          results.push(this.obstacles.push(new Full(this.game, obstacle.y, obstacle.lane)));
        } else {
          results.push(void 0);
        }
      }
      return results;
    };

    Level.prototype.loadTutotial = function() {
      this.uptut = new THREE.Mesh(Models.uptut.geometry, Models.uptut.materials);
      this.uptut.position.set(0, 0, 40);
      this.uptut.rotation.x += 90 * DEGREES_TO_RADIANS;
      this.uptut.scale.set(5, 5, 5);
      return this.game.addToScene(this.uptut);
    };

    Level.prototype.clear = function() {
      var i, len, obstacle, ref;
      ref = this.obstacles;
      for (i = 0, len = ref.length; i < len; i++) {
        obstacle = ref[i];
        obstacle.destroy();
      }
      this.floor.destroy();
      if (this.uptut) {
        return this.game.removeFromScene(this.uptut);
      }
    };

    Level.prototype.win = function() {
      this.clear();
      return this.game.removeFromScene(this.landscape);
    };

    return Level;

  })();

}).call(this);
